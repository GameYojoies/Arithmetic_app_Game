<div id="main" class="positionZero">

    <div id="body_main" class="bgSizeCover">
    </div>

    <!-- bg menu bar -->
    <div id="menu_bar_bg"
        style="position: absolute; bottom: 0; width: 100%; filter: drop-shadow(0px 0px 4px rgba(92, 122, 181, 0.08));">
        <img src="./pic/bg/BackgroundMenu.png" alt="" style="width: 100%; height: 100%;">
    </div>

    <div id="menu_main"
        style=" filter: drop-shadow(0px 0px 4px rgba(92, 122, 181, 0.08)); position: absolute; bottom: 0; width: 100%; background: transparent; overflow: hidden;">

        <div id="menu_main_content" class="coverMenu">

            <div id="menu_home" class="menuCss menuDiv">
                <div class="menuCss_pic">

                    <div class="menuOnClass" id="menuHome">
                        <svg width="30" height="30" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M12.5781 2.4552C13.4893 1.84446 14.6885 1.8486 15.5953 2.46562L24.8497 8.76208C25.2046 9.00354 25.4946 9.32613 25.695 9.70218C25.8953 10.0782 26 10.4965 26 10.9211V23.3753C26 24.8249 24.8061 26 23.3333 26H4.66663C3.19388 26 2 24.8249 2 23.3753V10.9329C2 10.5052 2.10621 10.0839 2.30938 9.70579C2.51256 9.32769 2.80654 9.00418 3.16574 8.76344L12.5781 2.4552ZM19.3333 19.4139H8.66667C7.93027 19.4139 7.33332 20.0014 7.33332 20.7262V20.7563C7.33332 21.4811 7.93027 22.0687 8.66663 22.0687H19.3333C20.0697 22.0687 20.6666 21.4811 20.6666 20.7563V20.7262C20.6666 20.0014 20.0697 19.4139 19.3333 19.4139Z"
                                fill="var(--bg-foot)" />
                        </svg>
                    </div>

                    <div class="menuOffClass" id="menuHome2" style="display: none;">
                        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M12.5781 2.4552C13.4893 1.84446 14.6885 1.8486 15.5953 2.46562L24.8497 8.76208C25.2046 9.00354 25.4946 9.32613 25.695 9.70218C25.8953 10.0782 26 10.4965 26 10.9211V23.3753C26 24.8249 24.8061 26 23.3333 26H4.66663C3.19388 26 2 24.8249 2 23.3753V10.9329C2 10.5052 2.10621 10.0839 2.30938 9.70579C2.51256 9.32769 2.80654 9.00418 3.16574 8.76344L12.5781 2.4552ZM19.3333 19.4139H8.66667C7.93027 19.4139 7.33332 20.0014 7.33332 20.7262V20.7563C7.33332 21.4811 7.93027 22.0687 8.66663 22.0687H19.3333C20.0697 22.0687 20.6666 21.4811 20.6666 20.7563V20.7262C20.6666 20.0014 20.0697 19.4139 19.3333 19.4139Z"
                                fill="#97979B" />
                        </svg>
                    </div>

                </div>
                <span class="menuSpan" id="menuHomeSpan">Home</span>
            </div>

            <div id="menu_trade" class="menuCss menuDiv">
                <div class="menuCss_pic">

                    <div class="menuOnClass" id="menuTrade" style="padding-top: 2px;">

                        <svg width="30" height="30" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M25.5573 22.0089L16.9324 27.3165C16.2689 27.7588 15.6055 27.3165 15.6055 26.4319V14.0474C15.6055 13.8263 15.8266 13.384 16.0478 13.1628L24.6727 7.85516C25.3361 7.41285 25.9996 7.85516 25.9996 8.73977V21.3454C25.9996 21.5666 25.7784 22.0089 25.5573 22.0089Z"
                                fill="var(--bg-foot)" />
                            <path
                                d="M3.4423 22.0101L12.0672 27.3177C12.7307 27.76 13.3941 27.3177 13.3941 26.4331V14.0486C13.3941 13.8275 13.173 13.3851 12.9518 13.164L4.32691 7.85636C3.88461 7.6352 3 8.07751 3 8.74096V21.3466C3 21.5678 3.22115 22.0101 3.4423 22.0101Z"
                                fill="var(--bg-foot)" />
                            <path
                                d="M14.2788 1L4.32697 4.75958C3.88466 4.98073 3.88466 5.64419 4.32697 5.86534L14.2788 12.0576C14.4999 12.0576 14.7211 12.0576 14.7211 12.0576L24.8941 5.86534C25.3364 5.64419 25.3364 4.98073 24.8941 4.75958L14.7211 1C14.4999 1 14.4999 1 14.2788 1Z"
                                fill="var(--bg-foot)" />
                        </svg>

                    </div>

                    <div class="menuOffClass" id="menuTrade2" style="display: none; padding-top: 2px;">

                        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M25.5573 22.0089L16.9324 27.3165C16.2689 27.7588 15.6055 27.3165 15.6055 26.4319V14.0474C15.6055 13.8263 15.8266 13.384 16.0478 13.1628L24.6727 7.85516C25.3361 7.41285 25.9996 7.85516 25.9996 8.73977V21.3454C25.9996 21.5666 25.7784 22.0089 25.5573 22.0089Z"
                                fill="#97979B" />
                            <path
                                d="M3.4423 22.0101L12.0672 27.3177C12.7307 27.76 13.3941 27.3177 13.3941 26.4331V14.0486C13.3941 13.8275 13.173 13.3851 12.9518 13.164L4.32691 7.85636C3.88461 7.6352 3 8.07751 3 8.74096V21.3466C3 21.5678 3.22115 22.0101 3.4423 22.0101Z"
                                fill="#97979B" />
                            <path
                                d="M14.2788 1L4.32697 4.75958C3.88466 4.98073 3.88466 5.64419 4.32697 5.86534L14.2788 12.0576C14.4999 12.0576 14.7211 12.0576 14.7211 12.0576L24.8941 5.86534C25.3364 5.64419 25.3364 4.98073 24.8941 4.75958L14.7211 1C14.4999 1 14.4999 1 14.2788 1Z"
                                fill="#97979B" />
                        </svg>

                    </div>


                </div>
                <span class="menuSpan" id="menuTradeSpan">Trade</span>

            </div>

            <div class="flexTop" style="width: 20%; height: 100%; flex-direction: column;">
                <img id="chat" src="./pic/logo/logomenu2.png" alt="" style="width: 50px; height: 50px; position: absolute; 
    bottom: -5px; left: 50%; transform: translate(-50%, -50%);">
            </div>

            <div id="menu_wallet" class="menuCss menuDiv">
                <div class="menuCss_pic">

                    <div class="menuOnClass" id="menuwallet">
                        <svg width="30" height="30" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M26 23.6124C26 23.9447 25.9427 24.2552 25.8282 24.5438C25.7137 24.8324 25.5507 25.0861 25.3392 25.3047C25.1278 25.5234 24.8811 25.6939 24.5991 25.8163C24.3172 25.9388 24.0088 26 23.674 26H4.48458C4.14978 26 3.8326 25.9388 3.53304 25.8163C3.23348 25.6939 2.96916 25.5234 2.74009 25.3047C2.51101 25.0861 2.3304 24.8324 2.19824 24.5438C2.06608 24.2552 2 23.9447 2 23.6124V10.5199C2 9.85523 2.23348 9.29112 2.70044 8.82759C3.1674 8.36406 3.73568 8.1323 4.40529 8.1323H23.5947C24.2643 8.1323 24.8326 8.36406 25.2996 8.82759C25.7665 9.29112 26 9.85523 26 10.5199V14.0882H20C19.3304 14.0882 18.7621 14.3156 18.2952 14.7704C17.8282 15.2252 17.5947 15.7849 17.5947 16.4496C17.6123 16.9044 17.7093 17.3067 17.8855 17.6565C18.0264 17.9538 18.2599 18.225 18.5859 18.4699C18.9119 18.7147 19.3833 18.8372 20 18.8372H26V23.6124ZM22.4053 6.92538H10.4053C11.3568 6.43561 12.2555 5.96334 13.1013 5.50856C13.8414 5.12374 14.5727 4.73892 15.2952 4.35411C16.0176 3.96929 16.5815 3.67193 16.9868 3.46203C17.6035 3.12969 18.1542 2.97664 18.6388 3.00288C19.1233 3.02912 19.533 3.1122 19.8678 3.25214C20.2555 3.44454 20.5903 3.69817 20.8722 4.01302L22.4053 6.92538ZM18.8106 16.4496C18.8106 16.1172 18.9251 15.8374 19.1542 15.61C19.3833 15.3826 19.6652 15.2689 20 15.2689C20.3348 15.2689 20.6167 15.3826 20.8458 15.61C21.0749 15.8374 21.1894 16.1172 21.1894 16.4496C21.1894 16.7819 21.0749 17.0662 20.8458 17.3023C20.6167 17.5384 20.3348 17.6565 20 17.6565C19.6652 17.6565 19.3833 17.5384 19.1542 17.3023C18.9251 17.0662 18.8106 16.7819 18.8106 16.4496Z"
                                fill="var(--bg-foot)" />
                        </svg>

                    </div>

                    <div class="menuOffClass" id="menuwallet2" style="display: none;">
                        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M26 23.6124C26 23.9447 25.9427 24.2552 25.8282 24.5438C25.7137 24.8324 25.5507 25.0861 25.3392 25.3047C25.1278 25.5234 24.8811 25.6939 24.5991 25.8163C24.3172 25.9388 24.0088 26 23.674 26H4.48458C4.14978 26 3.8326 25.9388 3.53304 25.8163C3.23348 25.6939 2.96916 25.5234 2.74009 25.3047C2.51101 25.0861 2.3304 24.8324 2.19824 24.5438C2.06608 24.2552 2 23.9447 2 23.6124V10.5199C2 9.85523 2.23348 9.29112 2.70044 8.82759C3.1674 8.36406 3.73568 8.1323 4.40529 8.1323H23.5947C24.2643 8.1323 24.8326 8.36406 25.2996 8.82759C25.7665 9.29112 26 9.85523 26 10.5199V14.0882H20C19.3304 14.0882 18.7621 14.3156 18.2952 14.7704C17.8282 15.2252 17.5947 15.7849 17.5947 16.4496C17.6123 16.9044 17.7093 17.3067 17.8855 17.6565C18.0264 17.9538 18.2599 18.225 18.5859 18.4699C18.9119 18.7147 19.3833 18.8372 20 18.8372H26V23.6124ZM22.4053 6.92538H10.4053C11.3568 6.43561 12.2555 5.96334 13.1013 5.50856C13.8414 5.12374 14.5727 4.73892 15.2952 4.35411C16.0176 3.96929 16.5815 3.67193 16.9868 3.46203C17.6035 3.12969 18.1542 2.97664 18.6388 3.00288C19.1233 3.02912 19.533 3.1122 19.8678 3.25214C20.2555 3.44454 20.5903 3.69817 20.8722 4.01302L22.4053 6.92538ZM18.8106 16.4496C18.8106 16.1172 18.9251 15.8374 19.1542 15.61C19.3833 15.3826 19.6652 15.2689 20 15.2689C20.3348 15.2689 20.6167 15.3826 20.8458 15.61C21.0749 15.8374 21.1894 16.1172 21.1894 16.4496C21.1894 16.7819 21.0749 17.0662 20.8458 17.3023C20.6167 17.5384 20.3348 17.6565 20 17.6565C19.6652 17.6565 19.3833 17.5384 19.1542 17.3023C18.9251 17.0662 18.8106 16.7819 18.8106 16.4496Z"
                                fill="#97979B" />
                        </svg>

                    </div>
                </div>
                <span class="menuSpan" id="menuwalletSpan">Wallet</span>

            </div>

            <div id="menu_profile" class="menuCss menuDiv">
                <div class="menuCss_pic">

                    <div class="menuOnClass" id="menuprofile">
                        <svg width="30" height="30" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M20.7255 13.9122C19.2598 15.145 17.314 15.9017 15.1696 15.9017C12.9933 15.9017 11.0154 15.1204 9.54319 13.8511C6.11875 14.7055 4 17.6225 4 21.1072V22.883C4 27.039 26 27.039 26 22.883V21.1072C25.9999 17.7143 23.9901 14.846 20.7255 13.9122ZM15.1696 14.6385C18.9653 14.6385 22.0506 11.8129 22.0506 8.32227C22.0506 4.83165 18.9717 2 15.1696 2C11.3802 2 8.29504 4.83165 8.29504 8.32227C8.29504 11.813 11.3802 14.6385 15.1696 14.6385Z"
                                fill="var(--bg-foot)" />
                        </svg>
                    </div>
                    <div class="menuOffClass" id="menuprofile2" style="display: none;">
                        <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M20.7255 13.9122C19.2598 15.145 17.314 15.9017 15.1696 15.9017C12.9933 15.9017 11.0154 15.1204 9.54319 13.8511C6.11875 14.7055 4 17.6225 4 21.1072V22.883C4 27.039 26 27.039 26 22.883V21.1072C25.9999 17.7143 23.9901 14.846 20.7255 13.9122ZM15.1696 14.6385C18.9653 14.6385 22.0506 11.8129 22.0506 8.32227C22.0506 4.83165 18.9717 2 15.1696 2C11.3802 2 8.29504 4.83165 8.29504 8.32227C8.29504 11.813 11.3802 14.6385 15.1696 14.6385Z"
                                fill="#97979B" />
                        </svg>
                    </div>
                </div>
                <span class="menuSpan" id="menuprofileSpan">profile</span>
            </div>

        </div>

    </div>



</div>

<script>

    var mainObj = new main();
    mainObj.init();
    video.pause();
            video1.pause();

    function main() {

        this.init = function () {
           
            setAllUILang("main")

            $("#menu_main,#menu_bar_bg").css({ "height": menuH });
            $("#body_main").css({ "height": h - menuH });

            $("#menu_home").unbind();
            $("#menu_home").click(function () {
                mainObj.menuhome();

            });

            $("#menu_trade").unbind();
            $("#menu_trade").click(function () {
                mainObj.menutrade();

            });

            $("#menu_wallet").unbind();
            $("#menu_wallet").click(function () {
                mainObj.menuwallet();

            });
            $("#menu_profile").unbind();
            $("#menu_profile").click(function () {
                mainObj.menuprofile();
                walletObj.getWallet();
                myteamObj.init();
                myteamObj.Peer_group();

                $("#body_content_team").css({ "display": "block" });



            });

            $('#chat').unbind();
            $('#chat').click(function () {
                // pageShow("chatPage")
                pageShow("newChatPage")
                newChatObj.call()
            })
            mResObj.showHtml("home2.html", "body_main");
            mResObj.showHtml("trade.html", "body_main");
            mResObj.showHtml("wallet.html", "body_main");
            mResObj.showHtml("profile.html", "body_main");

        }

        this.menuhome = function () {
            unShowMenuPage();

      
            $(".menuOnClass").css({ "display": "none" });
            $(".menuOffClass").css({ "display": "block" });
            $("#menuHome").css({ "display": "block" });
            $("#menuHome2").css({ "display": "none" });
            $("#menuHomeSpan").css({ "color": "#000", "font-size": "14px", "font-weight": "bold" });
            $("#menuTradeSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#menuwalletSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#menuprofileSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            // $("#body_main").css({ "background-image": "url(pic/new_bg.png)" });
            $("#main").css({ "background": "#FAFAFA" });
            home2Obj.init()
            home2Obj.call()
        }

        this.menutrade = function () {
            unShowMenuPage();

            $(".menuOnClass").css({ "display": "none" });
            $(".menuOffClass").css({ "display": "block" });
            $("#menuTrade").css({ "display": "block" });
            $("#menuTrade2").css({ "display": "none" });
            $("#menuHomeSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#menuTradeSpan").css({ "color": "#000", "font-size": "14px", "font-weight": "bold" });
            $("#menuwalletSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#menuprofileSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#main").css({ "background-color": "#FAFAFA" });

            //tradeObj.init()
            tradeObj.call();
        }

        this.menuwallet = function () {
            unShowMenuPage();

            $(".menuOnClass").css({ "display": "none" });
            $(".menuOffClass").css({ "display": "block" });
            $("#menuwallet").css({ "display": "block" });
            $("#menuwallet2").css({ "display": "none" });
            $("#menuHomeSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#menuTradeSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#menuwalletSpan").css({ "color": "#000", "font-size": "14px", "font-weight": "bold" });
            $("#menuprofileSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#main").css({ "background-color": "#FAFAFA" });

            walletObj.init();
            walletObj.call();

        }

        this.menuprofile = function () {
            unShowMenuPage();

            $(".menuOnClass").css({ "display": "none" });
            $(".menuOffClass").css({ "display": "block" });
            $("#menuprofile").css({ "display": "block" });
            $("#menuprofile2").css({ "display": "none" });
            $("#menuHomeSpan").css({ "color": "#97979B", "font-size": "14px" , "font-weight": "bold"});
            $("#menuTradeSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#menuwalletSpan").css({ "color": "#97979B", "font-size": "14px", "font-weight": "bold" });
            $("#menuprofileSpan").css({ "color": "#000", "font-size": "14px", "font-weight": "bold" });
            $("#main").css({ "background-color": "#FAFAFA" });

            profileObj.init()
            profileObj.call();


        }

        this.checkIsLogin = function () {
            getLocalToken();
            updateLoginStatus();
            if (token != null) {
                mainObj.refreshToken();
            } else {
                
                pageShow('getStartPage');
                getStartObj.call();
                $("#newsPopup").css({ "display": "none", })
                setTimeout(() => {
                    pageShow("loginPage");
                }, 100);

                // mainObj.menuhome()
            }
        }

        function unShowMenuPage() {
            $(".menuPage").each(function () {
                $("#" + this.id).transition({
                    x: 0
                }, 0);
            });
            $(".menuHeader").each(function () {
                $("#" + this.id).transition({
                    x: 0
                }, 0);
            });
        }

        function updateLoginStatus() {
            var isLogin = false;
            if (token != null) {
                var nowTimeStamp = (new Date()).getTime();
                if (token.expire) {
                    var expireTime = token.expire * 1000;
                    if (nowTimeStamp < expireTime) {
                        isLogin = true;
                    } else {
                        mainObj.refreshToken();
                    }
                }
            }

            if (isLogin) {
                pageUnShow("loginPage");
                pageUnShow('getStartPage');
                mainObj.menuhome();
            } else {
                pageShow('getStartPage');
                $("#newsPopup").css({ "display": "none", })
                setTimeout(() => {
                    pageShow("loginPage");
                }, 5000);
                // pageUnShow("loginPage");
                // mainObj.menuhome();
            }
        }

        function getLocalToken() {
            var tokenLocal = localStorage.getItem('token');
            if (tokenLocal != null) {
                token = JSON.parse(tokenLocal);
            }
        }


        var isRefreshTokenFinish = true;

        //30分钟刷新一次 รีเฟรชทุกๆ 30 นาที
        this.refreshToken = function () {

            if (refreshTokenTimer) {
                clearInterval(refreshTokenTimer);
            }
            refreshTokenTimer = setInterval(function () {
                refreshTokenFun();
            }, 1800000);
        }

        function refreshTokenFun() {

            if (token == null) {

                pageShow('getStartPage');
                $("#newsPopup").css({ "display": "none", })
                setTimeout(() => {
                    pageShow("loginPage");
                }, 5000);
                return;
            }

            var mData = { "token": token.refresh };

            isRefreshTokenFinish = false;

            $.ajax({
                type: "post",
                url: API_SERVER + "/v1/auth/refresh",
                data: JSON.stringify(mData),
                contentType: "application/json",
                dataType: "json",
                async: true,
                timeout: 100000,
                beforeSend: function (xmlhttprequest) {
                },
                success: function (data) {

                    if (data.code == 0) {
                        var tokenObj = data.result;
                        localStorage.setItem('token', JSON.stringify(tokenObj));
                        getLocalToken();
                        isRefreshTokenFinish = true;

                    } else {
                        mainObj.checkAjaxResult(data.code);
                    }
                },
                error: function (xmlhttprequest, error) {
                    console.log(error);
                },
                complete: function () {
                }
            });


        }

        this.checkAjaxResult = function (code, fun4001) {
            switch (code) {
                case 4001:
                    refreshTokenFun();
                    if (fun4001) {
                        fun4001();
                    } else {
                        logoutFun();
                    }
                    break;
                case 4002:
                    logoutFun();
                    break;
                case 4020:
                    if (isRefreshTokenFinish) {
                        Swal.fire({
                            icon: 'warning',
                            showConfirmButton: false,
                            title: `<span style='color:#1E232C;font-size: var(--text-size03);'><b id='main_device'></b></span>`,
                            html: '<div style="display: flex;justify-content: space-between;align-items: center;">' +
                                '</div>'
                        })
                            ;

                        logoutFun();
                    } else {
                        refreshTokenFun();
                    }
                    break;
            }

            function logoutFun() {
                localStorage.removeItem("token");
                token = null;
                mainObj.checkIsLogin();
                if (heartBeatTimer) {
                    clearInterval(heartBeatTimer);
                }
                if (refreshTokenTimer) {
                    clearInterval(refreshTokenTimer);
                }
            }
        }



    }


</script>