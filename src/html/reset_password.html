<div id="reset_passwordPage" style="background-color: white; position: absolute;">


    <div id="reset_password_header"></div>
    <div id="reset_password_scroll" style="width: 100%; overflow: hidden;">
        <div id="reset_password_body"
            style="display: flex; height: auto; align-items: center;  flex-direction: column; padding-top: 20px; background-color: #F8F8F8;">
            <!-- start box -->
            <div style="display: flex; justify-content: flex-start; width: 90%;  align-items: flex-start; ">
                <div>
                    当前密码 :
                </div>

            </div>

            <div
                style="display: flex; background-color: white; width: 100%; justify-content: center; align-items: center;padding: 10px 0px">
                <div style="width: 90%; display: flex; justify-content: space-between;">

                    <input id="passwordInput" style=" width: 100%; border: none; font-size: 18px;" type="password"
                        placeholder="当前密码">

                    <img id="eyeiconclose" alt="eye_close">
                    </span>
                </div>


            </div>
            <div style="height: 15px;"></div>
            <div style="display: flex; justify-content: flex-start; width: 90%;  align-items: flex-start; ">
                <div>
                    新密码 :
                </div>

            </div>

            <div
                style="display: flex; background-color: white; width: 100%; justify-content: center; align-items: center;padding: 10px 0px">
                <div style="width: 90%; display: flex; justify-content: space-between;">

                    <input id="passwordNew" style="  width: 100%; border: none; font-size: 18px;" type="password"
                        placeholder="新密码">

                    <img id="eyeicon_reset_New" alt="eye_close">
                    </span>
                </div>


            </div>
            <div style="height: 15px;"></div>
            <div style="display: flex; justify-content: flex-start; width: 90%;  align-items: flex-start; ">
                <div>
                    确认新密码:
                </div>

            </div>

            <div
                style="display: flex; background-color: white; width: 100%; justify-content: center; align-items: center;padding: 10px 0px">
                <div style="width: 90%; display: flex; justify-content: space-between;">

                    <input id="password_confirm" style=" width: 100%; border: none; font-size: 18px;" type="password"
                        placeholder="新密码">

                    <img id="eyeicon_reset_confirm" alt="eye_close">
                    </span>
                </div>


            </div>
            <div style="height: 60px;"></div>
            <div id="successful_btn"
                style="display: flex; background-color: red; width: 90%; justify-content: center; align-items: center;border-radius: 4px; padding: 10px 0; color: white;">

                二次确认
            </div>
            <!-- <div
                style="display: flex; justify-content: center; width: 90%;  text-align: center; flex-direction: column;">
                <div
                    style="display: flex; background-color: red; width: 100%; justify-content: center; align-items: center;border-radius: 4px; padding: 10px 0; color: white;">

                    提交
                </div>
                <div style="margin-top: 10px;">

                    <div>为了您的隐私安全，信息再确认后将无法修改</div>
                    <div style="color: #6C7BA8 ;">如需帮助，请联系 <span style="color: #E31D1A;">人工客服</span></div>
                </div>
            </div> -->

        </div>
    </div>
</div>
<script>

    var reset_passwordObj = new reset_password();
    reset_passwordObj.init();

    function reset_password() {

        this.init = function () {


            setAllUILang("reset_password")
            pageInit("reset_passwordPage");
            headerInit("reset_password", "更改密码")
            $("#reset_password_scroll").css({ "width": w, "height": h - headH });



            $('#reset_password_back').attr("src", picRes['back_arrow.png'])
            $('#reset_password_header_right_right').html('<img  id="reset_password_phone" style="width:28px;">')
            $('#reset_password_header_right_right').addClass("flexCenter")
            $('#reset_password_phone').attr("src", picRes['reset_password.png'])


            $('#eyeiconclose').attr("src", picRes['eye_close.png']).css("width", "30px");
            $('#eyeicon_reset_New').attr("src", picRes['eye_close.png']).css("width", "30px");
            $('#eyeicon_reset_confirm').attr("src", picRes['eye_close.png']).css("width", "30px");


            $("#eyeiconclose").click(function () {
                var passwordReset = document.getElementById("passwordInput");
                if (passwordReset.type === "password") {
                    passwordReset.type = "text";
                    $('#eyeiconclose').attr("src", picRes['eye_open.png']).css("width", "30px");
                } else {
                    passwordReset.type = "password";
                    $('#eyeiconclose').attr("src", picRes['eye_close.png']).css("width", "30px");

                }
            })

            $("#eyeicon_reset_New").click(function () {
                var passwordReset = document.getElementById("passwordNew");
                if (passwordReset.type === "password") {
                    passwordReset.type = "text";
                    $('#eyeicon_reset_New').attr("src", picRes['eye_open.png']).css("width", "30px");
                } else {
                    passwordReset.type = "password";
                    $('#eyeicon_reset_New').attr("src", picRes['eye_close.png']).css("width", "30px");

                }
            })

            $("#eyeicon_reset_confirm").click(function () {
                var passwordReset = document.getElementById("password_confirm");
                if (passwordReset.type === "password") {
                    passwordReset.type = "text";
                    $('#eyeicon_reset_confirm').attr("src", picRes['eye_open.png']).css("width", "30px");
                } else {
                    passwordReset.type = "password";
                    $('#eyeicon_reset_confirm').attr("src", picRes['eye_close.png']).css("width", "30px");

                }
            })


            $("#successful_btn").click(function () {

                changePassword()
            })

            setTimeout(() => {
                myScroll = new IScroll('#reset_password_scroll', { probeType: 1, mouseWheel: true });
            }, 300);



        }

        this.call = function () {
            getreset_password()
        }





        // $("#passwordInput, #passwordNew, #password_confirm").keypress(function (event) {
        //     var ew = event.which;
        //     if (48 <= ew && ew <= 57)
        //         return true;
        //     return false;
        // });


        function changePassword() {

            var oldPass = $('#passwordInput').val()
            var newPass = $('#passwordNew').val()
            var renewPass = $('#password_confirm').val()

            if (oldPass == newPass) {
                $('#msgPageContent').css({ 'text-align': 'center' });
                msgPageObj.show('抱歉，您的新密码不能与当前密码相同');
            }
            if (newPass != renewPass) {
                $('#msgPageContent').css({ 'text-align': 'center' });
                msgPageObj.show('新密码与确认新密码不匹配');
            }
            if (oldPass == "" || newPass == "" || renewPass == "") {
                $('#msgPageContent').css({ 'text-align': 'center' });
                msgPageObj.show('输入完整信息');
            }
            if ((oldPass != "") && (newPass != "") && (renewPass != "") && (newPass == renewPass) && (newPass != oldPass)) {

                $('#msgContent').css({ 'width': '85%' });
                msgObj.show('您确定要更改密码吗？', function () {
                    msgObj.unShow();
                    var mData = {
                        "cur": oldPass,
                        "latest": newPass,
                    }
                    $.ajax({
                        type: "POST",
                        url: API_SERVER + "/v1/profile/password",
                        headers: {
                            'Authorization': 'Bearer ' + token.token,
                        },
                        data: JSON.stringify(mData),
                        contentType: "application/json",
                        dataType: "json",
                        async: true,
                        timeout: 100000,
                        beforeSend: function (xmlhttprequest) {
                        },

                        success: function (data) {
                            loaderObj.show()
                            setTimeout(function () {
                                loaderObj.unShow();

                                if (data.code == 0) {

                                    // pageShow("reset_password_donePage");
                                    // pageShow("verifiedPage")
                                    msgPageObj.show("您已成功更改密码")
                                    cleanInput();
                                }
                                else {
                                    msgPageObj.show(getStatusCode(data.code), function () {
                                        cleanInput();
                                    });
                                }

                            }, 1000)

                        },

                        error: function (xmlhttprequest, error) {
                            loaderObj.unShow();
                            msgPageObj.show(NSLang('sys.serverError'))
                            cleanInput();
                        },

                    });
                }, function () {
                    cleanInput();
                    msgPageObj.unShow();
                });
            }
        }

        function cleanInput() {
            $('#passwordInput').val('')
            $('#passwordNew').val('')
            $('#password_confirm').val('')
        }


    }

</script>