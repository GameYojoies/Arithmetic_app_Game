<style>
    .default_tap_trade {
        border: 1px solid #5E6683;
    }

    .select_tap_trade {
        border: 1px solid #EA372A;
        background: linear-gradient(270deg, #EA372A 0%, #FD5E43 96.28%);
        color: #fff;

    }
</style>
<div class="menuHeader" id="tradeHeader"
    style=" position: absolute;display: flex;justify-content: center;align-items: center; font-size: 24px; font-weight: 700;  ">
    <span>市场</span>
    <img id="go_product_history" style="height: 28px;position: absolute;right: 22px;">
</div>
<div class="menuPage bg-my" id="tradePage" style="display: flex;background: #F5F5F5; ">

    <!-- <div id="scroll_menu_trade" style="width: 20%; overflow: hidden;">
        <div
            style="width: 100%; height: 510px; background: #fff; border-radius: 10px; box-shadow: 0px 5px 10px -3px rgba(0,0,0,0.1);">

         
            <div class="flexCenter" id="trade_memu2"
                style="width: 100%; height: 85px; color:#8D959B; flex-direction: column; text-align: center; ">
                <div id="trade_bg_memu2" style="height: 40px; width: 40px; border-radius: 100%; background:#F5F5F5 ; "
                    class="flexCenter">
                    <img id="trade_pic2" src="./pic/trade/trade2G.png" alt="" style="height: 14px; width: 18px;">
                </div>
                <span style="width: 90%; font-size: 14px; font-weight: bold;">算力+教育</span>
            </div>


      
            <div class="flexCenter" id="trade_memu3"
                style="width: 100%; height: 85px; color:#8D959B; flex-direction: column; text-align: center; ">
                <div id="trade_bg_memu3" style="height: 40px; width: 40px; border-radius: 100%; background:#F5F5F5 ; "
                    class="flexCenter">
                    <img id="trade_pic3" src="./pic/trade/trade3G.png" alt="" style="height: 18px; width: 18px;">
                </div>
                <span style="width: 90%; font-size: 14px; font-weight: bold;">算力+金融</span>
            </div>

    
            <div class="flexCenter" id="trade_memu4"
                style="width: 100%; height: 85px; color:#8D959B; flex-direction: column; text-align: center; ">
                <div id="trade_bg_memu4" style="height: 40px; width: 40px; border-radius: 100%; background:#F5F5F5 ; "
                    class="flexCenter">
                    <img id="trade_pic4" src="./pic/trade/trade4G.png" alt="" style="height: 16px; width: 17px;">
                </div>
                <span style="width: 90%; font-size: 14px; font-weight: bold;">算力+医疗</span>
            </div>


         
            <div class="flexCenter" id="trade_memu5"
                style="width: 100%; height: 85px; color:#8D959B; flex-direction: column; text-align: center; ">
                <div id="trade_bg_memu5" style="height: 40px; width: 40px; border-radius: 100%; background:#F5F5F5 ; "
                    class="flexCenter">
                    <img id="trade_pic5" src="./pic/trade/trade5G.png" alt="" style="height: 18px; width: 18px;">
                </div>
                <span style="width: 90%; font-size: 14px; font-weight: bold;">算力+交通</span>
            </div>

      
            <div class="flexCenter" id="trade_memu1"
                style="background: #FFF1EF; border-left: 4px solid #E31D1A; color: #E31D1A; width: 100%; height: 85px; flex-direction: column; text-align: center;  ">
                <div id="trade_bg_memu1" style="height: 40px; width: 40px; border-radius: 100%; background:#FCCACA ; "
                    class="flexCenter">
                    <img id="trade_pic1" src="./pic/trade/trade1.png" alt="" style="height: 19px; width: 18px;">
                </div>
                <span style="width: 90%; font-size: 14px; font-weight: bold;">算力+工业</span>
            </div>


       
            <div class="flexCenter" id="trade_memu6"
                style="width: 100%; height: 85px; color:#8D959B; flex-direction: column; text-align: center; ">
                <div id="trade_bg_memu6" style="height: 40px; width: 40px; border-radius: 100%; background:#F5F5F5 ; "
                    class="flexCenter">
                    <img id="trade_pic6" src="./pic/trade/trade6G.png" alt="" style="height: 17px; width: 14px;">
                </div>
                <span style="width: 90%; font-size: 14px; font-weight: bold;">算力+能源</span>
            </div>

        </div>
    </div> -->

    <div id="scroller_product" style="width: 100%; overflow: hidden; background: transparent;">

        <div style="height: auto; width: 100%;" class="flexTop_c">

            <div style="width: 90%; height: 150px; border-radius: 8px; position: relative; margin-top: 15px; gap: 10px; font-size: 16px; font-weight: bold; color: #fff;"
                class="flexCenter_c">
                <img src="./pic/trade/bg_trade.png" alt=""
                    style="position: absolute; width: 100%; height: 100%; z-index: -1;">
                <!-- <div class="flexSpac" style="width: 95%;">
                    <div class="flexCenter_c" style="gap: 10px; width: 50%;">
                        <span>可加速总额（RMB）</span>
                        <span style="font-size: 22px;">3000</span>
                    </div>
                    <div class="flexCenter_c" style="gap: 10px; width: 50%;">
                        <span>未加速（RMB）</span>
                        <span style="font-size: 22px;">3000</span>
                    </div>
                </div>

                <div class="flexSpac" style="width: 95%;">
                    <div class="flexCenter_c" style="gap: 10px; width: 50%;">
                        <span>今日加速（RMB）</span>
                        <span style="font-size: 22px;">2000</span>
                    </div>
                    <div class="flexCenter_c" style="gap: 10px; width: 50%;">
                        <span>累计收益（RMB）</span>
                        <span style="font-size: 22px;">5000</span>
                    </div>
                </div> -->

            </div>

            <div style="height: 15px;"></div>

            <div class="flexCenter" style="gap: 10px;">

                <div data-tab="10_group70" class="flexCenter tab_trade select_tap_trade" id="product_tab_10"
                    style="font-size: 18px; font-weight: bold; padding: 0 5px; height: 50px;border-radius: 7px; ">
                    <span>民族企业 <br> <span>助 力 区</span></span>

                </div>
                <div data-tab="10" class="flexCenter tab_trade select_tap_trade"
                    style="font-size: 18px; font-weight: bold;padding: 0 5px; height: 50px;border-radius: 7px; ">
                    <span>六大板块</span>
                </div>
                <div data-tab="40" class="flexCenter tab_trade default_tap_trade"
                    style="font-size: 18px; font-weight: bold; padding: 0 5px; height: 50px;border-radius: 7px; ">
                    <span>算力券</span>
                </div>
                <div data-tab="50" class="flexCenter tab_trade default_tap_trade"
                    style="font-size: 18px; font-weight: bold; padding: 0 5px; height: 50px;border-radius: 7px; ">
                    <span>龙力觉醒</span>
                </div>


            </div>

            <div id="show_data_alert_product_type">
                <div style="height: 15px;"></div>
                <div style="width: 100%; display: flex; background: #F2F2F2; ">
                    <img src="./pic/icons/icons_warnig.png" alt=""
                        style="padding-left: 15px; width: 14px; height: 14px; padding-top: 3px;">
                    <div style="padding-left: 5px; width: 85%; color: #6D6D6D;">
                        <span>说明：该区产品，仅限使用收益金额+算力券购买</span>
                        <span>所有产品，算力券可以抵扣部分购买金额</span>
                    </div>

                </div>

            </div>


            <div id="loop_product_show" style="height: auto; width: 100%; flex-direction: column; " class="flexTop">
            </div>

            <div style="height: 20px;"></div>
        </div>


    </div>


</div>

</div>
<script>
    var tradeObj = new trade();
    tradeObj.init();
    function trade() {

        var myScroll;
        var product_id = []
        var dayIncome;

        var tradeA = null;
        var timerCountInt = null;
        var productData = null;

        var TypeGroup70 = null

        this.init = function () {
            $("#tradeHeader").css({ "width": "100%", "height": headH, "left": (-1.0) * w, "top": 0 });
            $("#tradePage").css({ "width": w, "height": h - headH - menuH + 20, "position": "absolute", "left": (-1.0) * w, "top": headH });
            // $("#scroll_menu_trade").css({ "height": h - headH - menuH + 20, "top": headH });
            $("#scroller_product").css({ "height": h - headH - menuH + 20, "top": headH });

            // myScroll = new IScroll('#scroll_menu_trade', { probeType: 1, mouseWheel: true });
            myScroll = new IScroll('#scroller_product', { probeType: 1, mouseWheel: true });

            $('#go_product_history').attr("src", picRes['history.png'])

            $('#go_product_history').click(function () {
                pageShow('trade_historyPage')
                trade_historyObj.getHistory("All")
            })

            loadList();

            $('.tab_trade').unbind().click(function () {
                $(".tab_trade").removeClass("select_tap_trade default_tap_trade");
                $(this).addClass("select_tap_trade");
                $(".tab_trade").not(this).addClass("default_tap_trade");
                var tabId = $(this).data("tab");
                console.log("call API product type :" + tabId);
                if (tabId == 50) {
                    // msgPageObj.show('建设中')
                    TypeGroup70 = null
                    msgPageObj.show('<div style="font-size: 17px;">将于2024年中国算力大会期间开放！</div>');
                    console.log(TypeGroup70);
                }
                else if (tabId == "10_group70") {
                    TypeGroup70 = 70
                    console.log(TypeGroup70);
                    tradeObj.getProduct(10)
                }
                else {
                    TypeGroup70 = null
                    console.log(TypeGroup70);
                    tradeObj.getProduct(tabId)
                }

            })

        }
        this.call = function () {

            $("#tradePage").transition({
                x: w
            }, 0);
            $("#tradeHeader").transition({
                x: w
            }, 0);
            $('#product_tab_10').click()


            //$(".tab_trade").first().trigger("click");
            clearInterval(timerCountInt);
            timerCountInt = null;

            // tradeObj.getProduct(10, tradeA);
            myScroll.refresh()
        }

        this.tradeCustomData = function (tradeID) {
            // console.log(tradeID, '================获取应用自定义数据函数======tradeID=============>>>>');
            tradeA = tradeID;
            //tradeObj.getProduct(tradeA);
            if (tradeA == 1) {
                $(".product_buy_btn_class_un").css({ "display": "none" });
                $(".product_buy_btn_class").css({ "display": "block" });
            } else if (tradeA == 0) {
                $(".product_buy_btn_class_un").css({ "display": "block" });
                $(".product_buy_btn_class").css({ "display": "none" });
            }
            // console.log(tradeA, '================获取应用自定义数据函数======tradeID=============>>>>');

            // var tradeA = trademData.split(',')[0];
            // console.log(trademData, '================获取应用自定义数据函数======tradeA=============>>>>');


        }


        function countProductTimer() {
            if (productData != null) {
                for (var i = 0; i < productData.length; i++) {
                    var item = productData[i];
                    if (item.sellTime != null) {
                        var currentTime = new Date().getTime();
                        var diff = - currentTime + item.sellTime;
                        if (diff > 0) {
                            // 将时间差转换为天、小时、分钟、秒
                            var days = Math.floor(diff / (1000 * 60 * 60 * 24));
                            var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                            var seconds = Math.floor((diff % (1000 * 60)) / 1000);
                            var timeDisplay = "剩余时间：" + days + "天 " + hours + "小时 " + minutes + "分钟 " + seconds + "秒";
                            $("#product_" + item.id).html(timeDisplay);
                        } else {
                            $("#product_" + item.id).html('<span>立即购买</span>');
                        }
                    }
                }
            }
        }


        this.getProduct = function (type, tradeA) {
            console.log(tradeA, '================获取应用自定义数据函数======tradeA=============>>>>');
            console.log("<<<=========Group Type====== " + TypeGroup70 + "=====>>>");

            var str = ""
            var getToken = window.localStorage.getItem('token')
            var token = JSON.parse(getToken)

            $.ajax({
                type: 'get',
                // url: API_SERVER + `/v1/products?group=${id}`,
                url: API_SERVER + `/v1/products?type=${type}`,
                headers: {
                    'Authorization': 'Bearer ' + token.token,
                },
                async: true,
                timeout: 100000,
                success: function (data) {

                    if (data.code != 0) {
                        return;
                    }

                    var FilterGroup70 = data.result.filter(data => data.group === 70);

                    if (TypeGroup70 == 70) {
                        productData = FilterGroup70;
                    } 
                    else if ( type == 10) {
                        productData = data.result.filter(data => data.group !== 70);
                    } 
                    else {
                        productData = data.result;
                    }


                    if (productData.length == 0) {
                        str += '<div style="height: 40px;"></div>'
                        str += '<div style="font-size:14px; height: 50px; font-weight: bold; color:rgb(141, 149, 155);" class="flexCenter">产品尚未发售，敬请期待</div>';
                        $("#loop_product_show").html(str);
                        var myScroll = new IScroll('#scroller_product', { probeType: 1, mouseWheel: true, });
                    }
                    if (productData.length != 0) {

                        $.each(productData, function (index, data) {

                            //公式为：总收益 / 天数 =======这个数取四位小数，然后乘以100，然后除以价格，然后后面加一个百分号。
                            // var sumDayA = data.earningsYield;
                            // var sumDayB = data.cycle;
                            // var sumDayC = data.price;
                            // console.log(sumDayA, "-----------日收益-----------", sumDayA);
                            // var getDayCome = (sumDayA / sumDayB).toFixed(4);
                            // var dayIncome = (getDayCome * 100 / sumDayC).toFixed(2);
                            // console.log(getDayCome, "-----------日收益-----------", dayIncome);

                            // var dayIncome = (data.mathCouponPrice * 100)/(data.price * 1000) * 100


                            // 抵扣比例 = mathCouponPrice /（mathCouponPrice + price）
                            var dayIncome = ((data.mathCouponPrice / (data.mathCouponPrice + data.price) * 100)).toFixed(2);

                            var qingTouSum = data.mathCouponPrice + data.price;



                            var rebate
                            switch (data.dailyRebate) {
                                case true:
                                    rebate = '收益每天返';
                                    break;
                                case false:
                                    rebate = '收益到期返';
                                    break;
                            }

                            str += '<div style="height: 20px;"></div>'
                            str += '<div style="height: auto; width: 90%; background: transparent; border-radius:10px ; flex-direction: column; background: #fff;"class="flexSpac">'
                            str += '<div class="flexTop"style="position:relative; text-align: center; flex-direction: column; border-radius:10px;  height: auto; width: 100%; box-shadow: 0px 5px 10px -3px rgba(0,0,0,0.1);">'

                            str += '<img loading="lazy" src="' + (API_SERVER + data.images + '?Authorization=' + token.token) + '" alt=""style="width: 100%; height: 200px; border-radius: 10px">'

                            // str += '<div style="position:absolute; top:7px; right:7px;font-weight: bold;color: #fff;"> <span>龙力值  </span> <span>+' + data.activity + '</span></div>'
                            // str += '</div>'

                            str += '<div style="height: 10px;"></div>'
                            str += '<span style="font-weight: bold; width: 98%; font-size: 16px;text-align: left;">' + data.name + '</span>'

                            str += '<div style="height: 10px ;"></div>'

                            str += '<div style="width:98%;font-weight:bold; font-size:15px;gap:5px;" class="flexCenter">'

                            str += '<div style="width:32%; height:26px; background:#FBE2E2; color:#EB392B;" class="flexCenter">'
                            str += '<span>' + rebate + '</span>'
                            str += '</div>'

                            str += '<div style="width:32%; height:26px; background:#FBE2E2; color:#EB392B;" class="flexCenter">'
                            str += '<span>龙力值 +' + data.activity + '</span>'
                            str += '</div>'

                            str += '<div style="width:32%; height:26px; background:#FBE2E2; color:#EB392B;" class="flexCenter">'
                            str += (type == 10 ? '<span>+ ' + data.debtFund + ' 算力券</span>' : '<span>抵扣 ' + dayIncome + '%</span>')
                            str += '</div>'

                            str += '</div>'

                            str += '<div style="height: 15px;"></div>'

                            str += '<div class="flexSpac" style="font-weight: bold; width: 90%; font-size: 16px;justify-content: space-around;" >'

                            str += '<div class="flexCenter_c" style="gap: 10px;">'

                            str += '<span style="font-size: 17px;">' + (qingTouSum).toFixed(1) + ' 元</span><span style="font-size: 13px; color:#6D6D6D;">起投</span>'
                            str += '</div>'

                            str += '<div class="flexCenter_c" style="gap: 10px;">'
                            str += '<span style="font-size: 17px;">' + data.cycle + '天</span><span style="font-size: 13px; color:#6D6D6D;">项目周期</span>'
                            str += '</div>'

                            str += '<div class="flexCenter_c" style="gap: 10px;">'
                            str += '<span style="font-size: 17px;">' + (data.earningsYield.toFixed(1)) + ' 元</span><span style="font-size: 13px; color:#6D6D6D;">总收益</span>'
                            str += '</div>'


                            str += '</div>'

                            str += '<div style="height: 20px ;"></div>'

                            str += '<div class="flexTop_c" style="display: flex ; width: 98%; flex-direction:column; gap:20px;">'
                            str += '<div class="flexCenter" style="gap:5px; width:300px;">'
                            str += '<div id="Bar' + (data.id) + '" style=" position: relative; background:#F2F2F2 ; height: 12px; width: 100%; border-radius: 200px;">'
                            str += '<div id="Bar_2' + (data.id) + '"  class="flexRight" style=" font-size: 14px; color: #fff;  height: 98%; width: 1%; border-radius: 200px;"><span style="font-size: 10px;" id="loader_text' + (data.id) + '">0</span></div>'
                            str += '</div>'
                            str += '</div>'
                            str += '<span id="show_data_alert_product_type2" style="font-weight:bold; font-size:16px; color:#000; width: 300px; text-align:left;">算力券抵扣 ' + dayIncome + '%</span>'

                            // str += '<div id="product_' + data.id + '" style="border-radius: 10px; background: linear-gradient(270deg, #EA372A 0%, #FD5E43 96.28%); width: 300px; height: 46px; color: #fff; font-weight: bold; font-size: 16px;"class="flexCenter">'
                            // str += '<span>立即购买</span>'

                            //判断是否立即购买
                            //if (tradeA == 1) {

                            str += '<div class="product_buy_btn_class" style="display:none">'
                            str += '<div id="product_' + data.id + '" style="border-radius: 10px; background: linear-gradient(270deg, #EA372A 0%, #FD5E43 96.28%); width: 300px; height: 46px; color: #fff; font-weight: bold; font-size: 16px;"class="flexCenter">'
                            str += '<span>立即购买</span></div>'
                            str += '</div>'

                            //} else if (tradeA == 0) {
                            str += '<div class="product_buy_btn_class_un" style="display:block">'
                            str += '<div id="" style="border-radius: 10px; background: linear-gradient(270deg, #d9d9d9 0%, #d9d9d9 96.28%); width: 300px; height: 46px; color: #fff; font-weight: bold; font-size: 16px;"class="flexCenter">'
                            str += '<span>立即购买</span></div>'
                            str += '</div>'

                            //}

                            //str += '</div>'

                            str += '</div>'

                            str += '<div style="height: 15px ;"></div>'

                            str += '</div>'
                            str += '</div>'
                            product_id.push({
                                "id": data.id,
                                "p_name": data.name,
                                // "p_name2": rebate + '+收益',
                                "p_name2": rebate,
                                "progress": data.progress,
                                "start_invest": data.price,
                                "start_invest2": qingTouSum,
                                "earn": data.earningsYield,
                                "activity": data.activity,
                                "ratio": data.reinvestRatio,
                                "dayIncomeS": dayIncome,
                                "cycle": data.cycle,
                                "sellTime": data.sellTime,
                                "deducting": data.deducted,



                            })
                        })

                        $('#loop_product_show').html(str);
                        setTimeout(() => {
                            var myScroll = new IScroll('#scroller_product', { probeType: 1, mouseWheel: true, });
                        }, 500);

                        var show_type = $('#show_data_alert_product_type, #show_data_alert_product_type2')
                        if (type == 40) {
                            show_type.show()
                        } else {
                            show_type.hide()
                        }



                        $.each(product_id, function (index, data) {

                            $(`#product_${data.id}`).unbind().click(function () {
                                // msgObj.show('您确定要购买吗' + `<br>` + `<br>` + (data.p_name), function () {
                                //     msgObj.unShow();
                                //     get2FATrade(data.id)
                                // });

                                if (data.sellTime != null) {
                                    var currentTime = new Date().getTime();
                                    if (currentTime - data.sellTime < 0) {
                                        msgPageObj.show('产品还没有开始出售哦！')
                                        return;
                                    }
                                }

                                if (type == 40) {
                                    pageShow("summarize_product2Page")
                                    summarize_product2Obj.getDataBuy(data.id, data.p_name, data.p_name2, data.start_invest2, data.earn, data.activity, data.ratio, data.dayIncomeS, data.cycle)
                                } else {
                                    pageShow("summarize_productPage")
                                    summarize_productObj.getDataBuy(data.id, data.p_name, data.p_name2, data.start_invest, data.earn, data.activity, data.ratio, data.dayIncomeS, data.cycle,data.deducting)
                                }
                            })
                        });
                        BarLoading();

                        fetchAppCustomData();

                        timerCountInt = setInterval(function () {
                            countProductTimer();
                        }, 1000);
                    }
                }

            })


        }

        this.cleanInputTrade = function () {
            $("#trade_otp1").val('');
            $("#trade_otp2").val('');
            $("#trade_otp3").val('');
            $("#trade_otp4").val('');
            $("#trade_otp5").val('');
            $("#trade_otp6").val('');
        }

        function BarLoading() {
            $.each(product_id, function (index, bar) {

                var elem = $(`#Bar_2${bar.id}`); // Change to jQuery selector
                var loader_text = $(`#loader_text${bar.id}`); // Change to jQuery selector

                $(`#Bar_2${bar.id}`).css({
                    "border": '1px solid #F83D3D',
                    "background": '#F83D3D',
                    "height": '10px',
                    "border-radius": '200px',
                    "position": 'absolute',
                    "display": 'flex',
                    "justify-content": 'end',
                    "align-items": 'center'
                });

                var width = 0;
                var id = setInterval(frame, 10);
                function frame() {
                    if (width >= parseFloat(bar.progress)) {
                        clearInterval(id);
                    } else {
                        width++;
                        elem.css('width', `${width}%`); // Update width using jQuery
                        loader_text.text(`${width}`); // Update loader_text with percentage using jQuery
                    }
                }
                if (parseFloat(bar.progress) == 0) {
                    loader_text.hide(); // Use jQuery hide() function
                    elem.hide();
                }

            });
        }


        function loadList() {
            myScroll = new IScroll('#scroller_product', { probeType: 1, mouseWheel: true });
            myScroll.on('scroll', function () {
                console.log("====>" + this.y);
            });
            myScroll.on('scrollEnd', function () {
                console.log('====' + (new Date()));
            });
            myScroll.refresh();
        }

    }
</script>