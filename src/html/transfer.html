<div class="menuPage bg-my" id="transferPage" style="position: absolute; background: #FAFAFA;">
    <div id="transfer_header" style="position: relative;">

    </div>


    <div id="scroller_transfer">
        <div id="transfer_body" style="height: 900px; width: 100%; background: #F8F8F8;" class="flexTop_c">
            <div id="transfer_contents_1" style="width: 100%;" class="flexTop_c">
                <div style="height: 10px;"></div>
                <div style="width: 100%;height: 62px;background: #fff;gap: 10px;display: flex;align-items: center;">
                    <span style="font-size: 20px; padding-left: 20px;">对方账户</span>
                    <div style="width: 2px; height: 18px; background:#E31D1A ;"></div>
                    <!-- <input id="address_wallet" type="text" placeholder="对方手机号码"
                        style="height: 90%;width: 70%;border: none;font-size: 20px;padding-top: 3px;"> -->
                    <input id="address_wallet" type="text" placeholder="对方手机号码"
                        style="height: 90%; width: 70%; border: none; font-size: 20px; padding-top: 3px;"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 11);">

                </div>
                <div style="height: 10px;"></div>

                <div style="width: 90%; display: flex;">
                    <span style="font-size: 17px; color: #888888;">资金将实时到账，请确认再转账</span>
                </div>
                <div style="height: 10px;"></div>

                <span style="font-size: 17px; color: #888888; width: 90%;padding-bottom: 50px;">转账金额</span>
                <div style="width: 90%; display: flex; gap: 5px; font-size: 26px; height: 40px;">

                    <span style="padding-top: 5px;">￥</span>
                    <input id="transfer_input_money" type="number"
                        style="font-size: 36px; border: none; width: 90%; height: 90%; background: transparent;">
                </div>
                <hr style="width: 90%;">
            </div>
            <div style="height: 35px;"></div>

            <div id="transfer_next1"
                style="height: 47px; width: 90%; border-radius: 4px; background: linear-gradient(270deg, #EA372A 0%, #FD5E43 96.28%);"
                class="flexCenter">
                <span style="font-size: 16px; color: #fff;">下一步</span>
            </div>
        </div>

        <!-- <div id="transfer_contents_2" style="width: 100%; display: none;" class="flexTop_c">
                <div style="height: 20px;"></div>

                <div style="width: 90%; display: flex;  align-items: center; gap: 5px;">
                    <img id="transfer_user_icons" src="./pic/transfer/userIcon.png" alt=""
                        style="border-radius: 100%; height:33px ;">
                    <div style="gap: 3px;" class="flexTop_c">
                        <span id="transfer_show_to_user" style="font-size: 16px;">liulifang(**礼)</span>
                        <span style="color:#9E9E9E;">18000000001</span>
                    </div>

                </div>

                <div style="width: 90%; display: flex; gap: 15px; flex-direction: column;">
                    <span style="font-size: 14px; color: #888888;">资金将实时到账，请确认再转账</span>
                    <span style="font-size: 14px; color: #888888;">转账金额</span>
                </div>

                <div style="height: 15px;"></div>

                <div style="width: 90%; display: flex; gap: 5px; font-size: 26px; height: 40px;">
                    <span style="padding-top: 5px;">￥</span>
                    <input id="transfer_input_money" type="number"
                        style="font-size: 26px; border: none; width: 90%; height: 90%; background: transparent;">
                </div>
                <hr style="width: 90%;">

                <div style="height: 35px;"></div>

                <div id="transfer_next2"
                    style="height: 47px; width: 90%; border-radius: 4px; background: linear-gradient(270deg, #EA372A 0%, #FD5E43 96.28%);"
                    class="flexCenter">
                    <span style="font-size: 16px; color: #fff;">下一步</span>
                </div>
            </div> -->





    </div>
</div>

<!-- bg_shadow -->
<div id="bg_back_transfer"
    style="display: none; visibility: visible; height: 100%; width: 100%; z-index: 3;position: absolute;left: 0px;top: 0px;background-color: #000000;opacity: 0.4;justify-content: center;align-items: center;">
</div>

<!-- pop_code 6 digit -->
<div id="pop_up_check_code_transfer"
    style="display: none; z-index: 4;width: 100%; height: 100%; position: absolute; top: 0; left: 0;"
    class="flexCenter_c">

    <!-- code 6 digit -->
    <div id="transfer_code"
        style="display: flex; border-radius: 10px; height: 330px; width: 85%; background: #fff; color: #414655;"
        class="flexTop_c">
        <div style="height: 20px;"></div>
        <span style="font-weight: 600;">安全校验</span>
        <div style="height: 20px;"></div>
        <span style="font-size: 14px;">为了保障您的账户安全，请输入资金密码</span>
        <div style="height: 20px;"></div>

        <div style="width: 90%;" class="flexCenter">
            <form id="otpForm" class="flexCenter" style="gap: 5px;">
                <input id="top_digit1" class="code-input_transfer" type="text" pattern="\d" maxlength="1" required
                    style="width: 35px; height: 40px; text-align: center; border-radius: 4px; border: 1px solid #D5DADF" />
                <input id="top_digit2" class="code-input_transfer" type="text" pattern="\d" maxlength="1" required
                    style="width: 35px; height: 40px; text-align: center; border-radius: 4px; border: 1px solid #D5DADF" />
                <input id="top_digit3" class="code-input_transfer" type="text" pattern="\d" maxlength="1" required
                    style="width: 35px; height: 40px; text-align: center; border-radius: 4px; border: 1px solid #D5DADF" />
                <input id="top_digit4" class="code-input_transfer" type="text" pattern="\d" maxlength="1" required
                    style="width: 35px; height: 40px; text-align: center; border-radius: 4px; border: 1px solid #D5DADF" />
                <input id="top_digit5" class="code-input_transfer" type="text" pattern="\d" maxlength="1" required
                    style="width: 35px; height: 40px; text-align: center; border-radius: 4px; border: 1px solid #D5DADF" />
                <input id="top_digit6" class="code-input_transfer" type="text" pattern="\d" maxlength="1" required
                    style="width: 35px; height: 40px; text-align: center; border-radius: 4px; border: 1px solid #D5DADF" />
            </form>
        </div>
        <div style="height: 30px;"></div>

        <div
            style="width: 90%; font-size: 14px; display: flex; flex-direction: column; align-items:start; justify-content: left; gap: 5px;">
            <span>重要提醒：</span>
            <span>本次充值手续费1.00元，实际到账1,495.00元。</span>
        </div>

        <div style="height: 25px;"></div>
        <div style="height: 40px; gap:30px ; font-weight: 500;" class="flexCenter">
            <div id="btn_transfer_cancel"
                style="border-radius: 34px; height: 36px; width: 120px; color: #E31D1A; border: 1px solid #E31D1A; font-size: 16px;"
                class="flexCenter">
                <span>取消</span>
            </div>
            <div id="btn_transfer_confirm"
                style="border-radius: 34px; height: 36px; width: 120px; background: #E31D1A; color: #fff; font-size: 16px;"
                class="flexCenter">
                <span>确认</span>
            </div>
        </div>

    </div>

    <!-- success -->
    <div id="transfer_seccess"
        style="display: none; border-radius: 10px; height: 200px; width: 85%; background: #fff; color: #414655;"
        class="flexTop_c">
        <div style="height: 60px;"></div>
        <span style="font-size: 18px;">充值成功！</span>
        <div style="height: 30px;"></div>
        <div id="btn_top_up_success"
            style="border-radius: 34px; height: 36px; width: 120px; background: #E31D1A; color: #fff; font-size: 16px;"
            class="flexCenter">
            <span>确认</span>
        </div>
    </div>
</div>
</div>


<script>
    var transferObj = new transfer();
    transferObj.init();

    function transfer() {
        var myScroll;

        var limitInputTransfer;

        this.init = function () {
            pageInit("transferPage");
            headerInit("transfer", "转账")
            $("#transfer_Page").css({ "width": w, "height": h });
            $("#scroller_transfer").css({ "width": w, "height": h - headH, "overflow": "hidden" });

            $('#transfer_header_right_right').html('<img id="go_transfer" style="height: 27px;position: absolute;right: 15px;top: 13px;">')
            $('#go_transfer').attr("src", picRes['go_assets.png'])

            myScroll = new IScroll('#scroller_transfer', { probeType: 1, mouseWheel: true });

            $("#transfer_input_money").keypress(function (event) {
                var ew = event.which;
                if (48 <= ew && ew <= 57)
                    return true;
                return false;
            });

            $("#transfer_header_left").click(function () {
                cleanInput()
                // setTimeout(() => {
                //     $('#transfer_contents_1').css({ "display": "flex" })
                //     $('#transfer_contents_2').css({ "display": "none" })
                // }, 300);
            });

            $("#go_transfer").click(function () {
                history_transferObj.GetTransferHistory();

                pageShow("transaction_hisPage")
            });
            $("#transfer_contents_1").click(function () {
                // $(this).css({ "display": "none" })
                // $('#transfer_contents_2').css({ "display": "flex" })
            });
            $("#transfer_next1").click(function () {
                CheckTransferInput()
            });

            $('#btn_transfer_cancel,#transfer_seccess').unbind().click(function () {
                $("#pop_up_check_code_transfer, #bg_back_transfer").css({ "display": "none" });
            })

            $('#transfer_next2').unbind().click(function () {
                $("#pop_up_check_code_transfer, #bg_back_transfer, #transfer_code").css({ "display": "flex" });
                $("#transfer_seccess").css({ "display": "none" });
            })

            $('#btn_transfer_confirm').unbind().click(function () {
                $("#transfer_code").css({ "display": "none" });
                $("#transfer_seccess").css({ "display": "flex" });

            })

            // input code
            $(".code-input_transfer").on("input", function () {
                moveToNext($(this));
            });

            $(".code-input_transfer").on("keydown", function (e) {
                if (e.which === 8 && $(this).val().length === 0) {
                    // Backspace pressed and input field is empty
                    $(this).prev(".code-input_transfer").focus();
                }
            });





        }

        this.call = function (data) {
            $('#transferPage').transition({
                x: w
            }, 0);

        }

        this.setLimitInput = function (data) {
            limitInputTransfer = data[2]
        }

        function CheckTransferInput() {

            var mobileValue = $("#address_wallet").val();
            var amountValue = $("#transfer_input_money").val();

            if (mobileValue.length !== 11) {
                msgPageObj.show("请输入11位手机号码 ")
                return;
            }
            else if (parseFloat(amountValue) <= 0) {
                msgPageObj.show("转账金额必须大于0 ")
                return;
            }
            else if (parseFloat(amountValue) < limitInputTransfer) {
                msgPageObj.show("最低转账金额为" + limitInputTransfer)
                return;
            } else {
                get2FATrade()
                console.log('<<<==============verify 2FA===============>>>');
            }

        }

        function get2FATrade() {
            var Token = localStorage.getItem('token')
            var obj = JSON.parse(Token);
            $.ajax({
                type: "get",
                url: API_SERVER + "/v1/twoFA",
                headers: {
                    'Authorization': 'Bearer ' + obj.token
                },
                contentType: "application/json",
                dataType: "json",
                async: true,
                timeout: 100000,

                success: function (data) {
                    loaderObj.show();
                    if (data.result.status == false) {
                        loaderObj.unShow();

                        msgObj.show('您尚未开启交易密码', function () {
                            msgObj.unShow()
                            settingObj.call()
                            pageShow('settingPage')
                        })
                    }

                    if (data.result.status == true) {
                        loaderObj.unShow();
                        msgObj.show(
                            '<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;width: 100%;"><div id="Trade2FA" style="margin-bottom:20px">请输入交易密码</div><input style="width:100%;height:30px;font-size: 19px;" id="Trade2FA_Input" type="password" placeholder="请输入交易密码" /></div>', function () {
                                msgObj.unShow();
                                verify2faTrade()

                            }, function () {
                                msgObj.unShow();

                            });

                        // $("#Trade2FA_Input").keypress(function (event) {
                        //     var ew = event.which;
                        //     if (48 <= ew && ew <= 57)
                        //         return true;
                        //     return false;
                        // });
                    }

                },
                error: function (xmlhttprequest, error) {
                    console.log(error, xmlhttprequest);
                }
            })
        }

        function verify2faTrade() {
            var getToken = localStorage.getItem('token')
            var token = JSON.parse(getToken)
            var InputPassword = $("#Trade2FA_Input").val()
            var mData = {
                "password": InputPassword,
            }
            $.ajax({
                type: "post",
                url: API_SERVER + "/v1/twoFA/verify",
                headers: {
                    'Authorization': 'Bearer ' + token.token,
                },
                data: JSON.stringify(mData),
                contentType: "application/json",
                dataType: "json",
                async: true,
                timeout: 100000,
                beforeSend: function (xmlhttprequest) { },
                success: function (data) {
                    loaderObj.unShow();

                    if (data.code == 0) {
                        msgObj.unShow()
                        setTimeout(() => {
                            postTransder()
                        }, 500)
                    }
                    else {
                        msgPageObj.show(getStatusCode(data.code))
                    }
                },
                error: function (xmlhttprequest, error) {
                    loaderObj.unShow();
                    msgPageObj.show(NSLang('sys.serverError'))
                    cleanInput();
                },
            });
        }

        function postTransder() {

            var mobileValue = $("#address_wallet").val();
            var amountValue = parseFloat($("#transfer_input_money").val());
            var getToken = localStorage.getItem('token')
            var token = JSON.parse(getToken)

            var mData = {
                "mobile": mobileValue,
                "amount": amountValue,
            };
            $.ajax({
                type: "POST",
                url: API_SERVER + "/v1/wallet/transfer",
                headers: {
                    'Authorization': 'Bearer ' + token.token,
                },
                data: JSON.stringify(mData),
                contentType: "application/json",
                dataType: "json",
                async: true,
                timeout: 100000,
                beforeSend: function (xmlhttprequest) {
                },
                success: function (data) {
                    loaderObj.unShow();
                    if (data.code == 0) {
                        // cleanInput();
                        msgPageObj.show("转账成功")
                        cleanInput();
                    }
                    else {
                        msgPageObj.show(getStatusCode(data.code))
                    }
                },
                error: function (xmlhttprequest, error) {
                    loaderObj.unShow();
                    msgPageObj.show(NSLang('sys.serverError'))
                    // cleanInput();
                },
            });
        }
        function cleanInput() {
            $("#transfer_input_money").val('')
            $("#address_wallet").val('');
        }

    }

</script>